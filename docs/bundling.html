<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">

    <!-- Basic -->
    <title>Code bundling | ReactQL</title>
    <meta name="description" content="How ReactQL bundles, minifies and optimises your code">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- favicons -->
    <link rel="shortcut icon" type="image/png" href="images/favicons/32x32.png" sizes="32x32" />
    <link rel="shortcut icon" type="image/png" href="images/favicons/16x16.png" sizes="16x16" />

    <!-- Social -->
    <meta property="og:type" content="article">
    <meta property="og:url" content="http://reactql.js.org">
    <meta property="og:title" content="Code bundling | ReactQL">
    <meta property="og:description" content="How ReactQL bundles, minifies and optimises your code">
    <meta property="og:image" content="">
    <meta name="twitter:card" content="summary_image_large">
    <meta name="twitter:site" content="">
    <meta name="twitter:title" content="Code bundling | ReactQL">
    <meta name="twitter:description" content="How ReactQL bundles, minifies and optimises your code">
    <meta name="twitter:image" content="">

    <!-- Misc -->
    <meta name="google-site-verification" content="" />
    <link href='https://fonts.googleapis.com/css?family=Source+Sans+Pro:400,300,200,300italic,400italic' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="/docs/style/style.css">
  </head>
  <body class="">
    

<div class="nav dark">
  <div class="nav-group">
    <div class="nav-item show-mobile">
      <span class="js-sidebar-toggle ">
        <span class="icon-menu"></span>
      </span>
    </div>
    <div class="nav-item">
      
      <a class="logo-wrapper" href="https://reactql.org" title="ReactQL Docs Modern stack for React+GraphQL"  >
        <img src="images/reactql-logo.svg" alt="ReactQL Docs" class="logo"/>
      </a>
    </div>
  </div>

  <div class="nav-group right">
    
      
      <div class="nav-item show-desktop false ">
        <a class="link" href="https://reactql.org"  >
          <span>Main site</span>
        </a>
      </div>
    
      
      <div class="nav-item show-desktop false ">
        <a class="link" href="https://github.com/leebenson/reactql"  >
          <span>Github</span>
        </a>
      </div>
    
  </div>
</div>

<div class="sidebar">
  <div class="panel">
    <div class="panel-item">
      <a class="" href="https:/reactql.org" title="ReactQL Docs"  >
        <span>ReactQL Docs Modern stack for React+GraphQL</span>
      </a>
    </div>
    
      <div class="panel-item "">
        <a class="" href="https://reactql.org"  >
          <span>Main site</span>
        </a>
      </div>
    
      <div class="panel-item "">
        <a class="" href="https://github.com/leebenson/reactql"  >
          <span>Github</span>
        </a>
      </div>
    
  </div>

  <div class="sidebar-content">
    <div class="topcap">
      <span class="title-sidebar">ReactQL</span>
      
    </div>

    

    <ul class="toc">
      
        <li>
          
          <ul class="list-toc">
            
              
              <li class="item-toc ">
                <a href="index.html" class="sidebar-link ">
                  <span>Welcome</span>
                </a>
              </li>
            
          </ul>
        </li>
      
        <li>
          
            <div class="heading-toc">Setup</div>
          
          <ul class="list-toc">
            
              
              <li class="item-toc ">
                <a href="setup.html" class="sidebar-link ">
                  <span>Installation</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="layout.html" class="sidebar-link ">
                  <span>Project layout</span>
                </a>
              </li>
            
          </ul>
        </li>
      
        <li>
          
            <div class="heading-toc">Writing Code</div>
          
          <ul class="list-toc">
            
              
              <li class="item-toc ">
                <a href="styleguide.html" class="sidebar-link ">
                  <span>Styleguide</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="css.html" class="sidebar-link ">
                  <span>CSS stylesheets</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="modules.html" class="sidebar-link ">
                  <span>Module resolution</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="graphql.html" class="sidebar-link ">
                  <span>GraphQL components</span>
                </a>
              </li>
            
          </ul>
        </li>
      
        <li>
          
            <div class="heading-toc">Concepts</div>
          
          <ul class="list-toc">
            
              
              <li class="item-toc ">
                <a href="routing.html" class="sidebar-link ">
                  <span>Routing</span>
                </a>
              </li>
            
              
              <li class="item-toc  current">
                <a href="" class="sidebar-link  current">
                  <span>Code bundling</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="ssr.html" class="sidebar-link ">
                  <span>Server side rendering (SSR)</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="env.html" class="sidebar-link ">
                  <span>Server/browser awareness</span>
                </a>
              </li>
            
          </ul>
        </li>
      
        <li>
          
            <div class="heading-toc">Resources</div>
          
          <ul class="list-toc">
            
              
              <li class="item-toc ">
                <a href="faq.html" class="sidebar-link ">
                  <span>FAQ</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="support.html" class="sidebar-link ">
                  <span>Support</span>
                </a>
              </li>
            
          </ul>
        </li>
      
    </ul>
  </div>
</div>

<div class="content">
  <div class="content-wrapper">
    <div class="header-content">
      <h1 class="title-page">Code bundling</h1>
      
        <div class="subtitle-page">How ReactQL bundles, minifies and optimises your code</div>
      

      <div class="page-actions">
        <div class="actions-group">
          <a class="btn tertiary small round lowercase" href="https://github.com/leebenson/reactql-docs/tree/master/source/bundling.md" target="_blank"><span class="icon-github"></span> <span>Edit on GitHub</span></a>
        </div>
      </div>
    </div>

    <div class="document-formatting">
      <h2 id="overview">Overview</h2>

<hr>
<p>ReactQL comes with an <a href="https://github.com/leebenson/reactql/tree/master/kit/webpack" target="_blank" rel="external">extensible</a> Webpack 2 configuration that bundles and optimises your code, for both development and production.</p>
<p>In this doc, you’ll learn how it works with your Javascript, CSS and static assets.</p>
<h2 id="basics">Basic concepts: Webpack 2</h2>

<hr>
<p><a href="https://webpack.js.org/" target="_blank" rel="external">Webpack</a> is a code bundling tool that turns your raw source code into a single ‘bundle’ file that can run in the browser.</p>
<p>Out-the-box, ReactQL uses syntax that a regular browser cannot understand without being <a href="https://en.wikipedia.org/wiki/Source-to-source_compiler" target="_blank" rel="external">transpiled</a> down to plain Javascript.</p>
<p>This can include variants of JS that don’t yet ship with common Javascript interpreters that are bundled with browsers (such as native <code>async/await</code> code, or module <code>import</code> statements), as well as features that are unique to Webpack, such as the ability to use local <code>.css</code> files and translate stylesheet classnames into <a href="css.html#local">locally hashed versions</a>.</p>
<p>This is where Webpack comes in. It will translate many files of source code into a single bundle that will be loaded along with your HTML code in the browser. That’s why it’s valid to write code like this:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// importing a .css file and treating it like JS would be impossible in a browser...</span></div><div class="line"><span class="keyword">import</span> style <span class="keyword">from</span> <span class="string">'./someFile.css'</span></div><div class="line"><span class="built_in">console</span>.log(style.someClassName); <span class="comment">// &lt;-- woah!</span></div></pre></td></tr></table></figure>
<p>… and actually see it working in the browser.</p>
<p>Furthermore, it includes several pre-processors that will crunch and optimise your code for production, as well as provides functionality for spawning a development server with sourcemaps, hot code reloading and more.</p>
<h2 id="server">Server bundling</h2>

<hr>
<p>Webpack isn’t just for the browser. ReactQL will also generate an optimised <em>server</em> bundle that’s ready to use in production.</p>
<p>This allows you to write your code to target a ‘universal’ platform, that will run in exactly the same way in the browser as well as via a Node.js server.</p>
<p>Just like in the browser, that makes code like this perfectly valid on the server:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// importing a .css file and treating it like JS would be impossible in a browser...</span></div><div class="line"><span class="keyword">import</span> json <span class="keyword">from</span> <span class="string">'config/someConfig.json'</span></div><div class="line"><span class="built_in">console</span>.log(json.apiKey); <span class="comment">// &lt;-- what the...?!</span></div></pre></td></tr></table></figure>
<p>The server bundle contains a built-in <a href="http://koajs.com/" target="_blank" rel="external">Koa web server</a> that will listen to HTTP requests, render the relevant React code into HTML, and serve it back to your user.</p>
<p>This allows you to offer fast <em>time-to-first-byte</em> to visitors, without waiting for the full browser bundle to download and process first. Instead, users will be greeted with initial HTML and all styles intact, giving a more ‘progressive’ experience when the bundle eventually loads.</p>
<h2 id="config">Config files</h2>

<hr>
<p>See the <a href="layout.html#kit-webpack">Webpack project layout</a> for details which Webpack files are relevant for bundling in development and production, in both a browser and server context. You can edit the config to include new Webpack loaders or change the configuration as needed.</p>
<h2 id="where">Where Webpack looks for code</h2>

<hr>
<p>See <a href="modules.html">module resolution</a>.</p>
<blockquote>
<p><em>TL;DR</em> Your project root first, then <code>node_modules</code></p>
</blockquote>
<h2 id="styles">CSS / stylesheets</h2>

<hr>
<p>You can import <code>.css</code> or <code>.scss</code>/<code>.sass</code> (<a href="http://sass-lang.com/" target="_blank" rel="external">SASS</a>) stylesheets by simply <code>import/require</code>ing from any Javascript file:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// `styles` will be an object that contains a list of exported 'hashed' classnames</span></div><div class="line"><span class="keyword">import</span> styles <span class="keyword">from</span> <span class="string">'src/css/whatever.css'</span>;</div></pre></td></tr></table></figure>
<p>Classnames will be <a href="https://github.com/webpack-contrib/css-loader#css-scope" target="_blank" rel="external">hashed</a> to prevent bleeding out to the global scope. This can be overridden by nesting classes in a <code>:global</code> block</p>
<blockquote>
<p>See <a href="css.html">Stylesheets docs</a> for examples.</p>
</blockquote>
<p><code>@import</code> statements within CSS will be concatenated in the final bundle:</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">@<span class="keyword">import</span> url(other/css/file.css);</div></pre></td></tr></table></figure>
<p>If you’re using SASS, imports will be processed via SASS first; settings, SASS variables and functions will be available to any CSS file that uses <code>@import</code> to pull from a parent SASS file.</p>
<h2 id="images">Images</h2>

<hr>
<p>Import <code>.gif</code>, <code>.jp(e?)g</code>, <code>.png</code> or <code>.svg</code> images using standard <code>import</code> or <code>require</code> syntax:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// `backgroundImage` will be a string of the filename, relative to `[root]/dist/public`</span></div><div class="line"><span class="keyword">import</span> backgroundImage <span class="keyword">from</span> <span class="string">'./bg.png'</span>;</div></pre></td></tr></table></figure>
<p>You can then use the filename in your code, as usual:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> Component = (</div><div class="line">  &lt;div&gt;</div><div class="line">    &#123; /* `image` = string containing path to file name */ &#125;</div><div class="line">    &lt;SomeOtherComponent image=&#123;backgroundImage&#125; /&gt;</div><div class="line">  &lt;/div&gt;</div><div class="line">);</div></pre></td></tr></table></figure>
<p>You can also include images in your CSS files, which will be processed by Webpack, too:</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="selector-class">.logo</span> &#123;</div><div class="line">  <span class="comment">/* this will be processed exactly the same way as if imported in JS */</span></div><div class="line">  <span class="attribute">background-image</span>: <span class="built_in">url</span>(<span class="string">'./path/to/file.png'</span>);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="Image-compression"><a href="#Image-compression" class="headerlink" title="Image compression"></a>Image compression</h3><p>In production, images are processed through <a href="https://github.com/tcoopman/image-webpack-loader" target="_blank" rel="external">image-webpack-loader</a>, which minifies JPEG, GIF, PNG and SVG files via <a href="https://github.com/imagemin/imagemin" target="_blank" rel="external">imagemin</a> and copied to <code>[root]/dist/public/assets/img</code>. In development, original images files are served from memory (and compression is skipped), and no files are copied to the physical filesystem.</p>
<blockquote>
<p>By default, the JPG compression is set at 65% the quality of the original, and PNG has a target range of 65-90%. If images appear fuzzy, you can override this by editing <a href="https://github.com/leebenson/reactql/blob/master/kit/webpack/base.js" target="_blank" rel="external">kit/webpack/base.js</a></p>
</blockquote>
<h2 id="fonts">Fonts</h2>

<hr>
<p>Font files (<code>.woff</code>, <code>.woff2</code>, <code>.ttf</code>, <code>.eot</code>) can be included in any CSS in the usual way:</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">@font-face &#123;</div><div class="line">  font-family: 'SomeCustomFont';</div><div class="line">  font-style: normal;</div><div class="line">  font-weight: 400; url(static/fonts/customFont.woff2) format('woff2');</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// `fontFile` = 'assets/fonts/whatever.ttf'</span></div><div class="line"><span class="keyword">import</span> fontFile <span class="keyword">from</span> <span class="string">'static/whatever.ttf'</span>;</div></pre></td></tr></table></figure>
<blockquote>
<p>Files imported in a <code>.js</code> file return the string to the filename, relative to <code>[root]/dist/public/</code>:</p>
</blockquote>
<p>No transformation is performed on font files; original files will simply be copied to <code>dist/public/assets/fonts</code> in production.</p>
<h2 id="json">JSON</h2>

<hr>
<p>JSON stored in a <code>.json</code> file will be processed through <a href="https://github.com/webpack-contrib/json-loader" target="_blank" rel="external">json-loader</a>, and return a parsed Javascript object of the JSON data.</p>
<p>Example:</p>
<p><strong>data.json</strong><br><figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  <span class="attr">"name"</span>: <span class="string">"ReactQL"</span></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p><strong>app.js</strong><br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// `data` will be &#123; name: "ReactQL" &#125;</span></div><div class="line"><span class="keyword">import</span> data <span class="keyword">from</span> <span class="string">'./data.json'</span>;</div><div class="line"><span class="built_in">console</span>.log(data.name);</div></pre></td></tr></table></figure></p>
<blockquote>
<p>JSON data is always bundled with the main code, and not stored in separate files - both in development and in production.</p>
</blockquote>
<h2 id="development">Development mode</h2>

<hr>
<p>To start a development server, run:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">npm start</div></pre></td></tr></table></figure>
<p>This is intended for on your local development machine. As you make changes, they will be reflected in the browser in real-time.</p>
<p>This is what Webpack will do when spawning a dev server:</p>
<ol>
<li><p>It will load your configuration at <a href="https://github.com/leebenson/reactql/blob/master/kit/webpack/browser_dev.js" target="_blank" rel="external">kit/webpack/browser_dev.js</a></p>
</li>
<li><p>Webpack will start processing code in the <a href="https://github.com/leebenson/reactql/blob/master/kit/entry/browser.js" target="_blank" rel="external">kit/src/browser.js</a> entry file, start a development server at <a href="http://localhost:8080" target="_blank" rel="external">http://localhost:8080</a> and compile your source code into ‘in memory’ code bundles, at <a href="http://localhost:8080/vendor.js" target="_blank" rel="external">http://localhost:8080/vendor.js</a> (for third-party NPM code) and <a href="http://localhost:8080/bundle.js" target="_blank" rel="external">http://localhost:8080/bundle.js</a> (your own code). No physical files are stored on the filesystem.</p>
</li>
<li><p>All routes will be served by <a href="https://github.com/leebenson/reactql/blob/master/static/webpack.html" target="_blank" rel="external">static/webpack.html</a>. In development mode, there is no server-side rendering. Everything is loaded in the browser. That means GraphQL data fetching or anything ‘async’ will cause React to re-render with the correct props once it’s retrieved them.</p>
</li>
<li><p>Stylesheets will be included as inline code inside <code>bundle.js</code>. You might notice a <a href="https://en.wikipedia.org/wiki/Flash_of_unstyled_content" target="_blank" rel="external">flash of unstyled content</a> as <code>/bundle.js</code> is first loaded before snapping your styles into place.</p>
</li>
<li><p>The <code>./static</code> folder becomes your public route. Anything you might place in here - images, third-party scripts, etc - will be served ‘unprocessed’, in their original form.</p>
</li>
<li><p>A small snippet of code will be added to your in-memory <code>/vendor.js</code> entrypoint for handling hot code reload via websockets. Whenever you make changes to your code, the browser is ‘injected’ with the code difference and reflected in real-time.</p>
</li>
</ol>
<p>Development mode is not intended for production environments. Code bundles will be larger than production versions due to unminified sourcemaps and original files, and there is no server-side rendering in this mode.</p>
<h2 id="production">Production mode</h2>

<hr>
<p>To build assets fit for deployment, run:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">npm run build</div></pre></td></tr></table></figure>
<p>Webpack will follow these steps:</p>
<ol>
<li><p>It will first build your <em>browser</em> bundle by loading the Webpack config file at <a href="https://github.com/leebenson/reactql/blob/master/kit/webpack/browser_prod.js" target="_blank" rel="external">kit/webpack/browser_prod.js</a>, which will use <a href="https://github.com/leebenson/reactql/blob/master/kit/entry/browser.js" target="_blank" rel="external">kit/src/browser.js</a> as its entrypoint.</p>
</li>
<li><p>Webpack will then build your <em>server</em> bundle by loading the Webpack config file at <a href="https://github.com/leebenson/reactql/blob/master/kit/webpack/server.js" target="_blank" rel="external">kit/webpack/server.js</a>, which will use <a href="https://github.com/leebenson/reactql/blob/master/kit/entry/server.js" target="_blank" rel="external">kit/src/server.js</a> as its entrypoint.</p>
</li>
<li><p>Assets will appear in a new <code>[root]/dist</code> folder. A sub-folder, <code>./dist/public</code> is created which becomes the public entry point for the built-in <a href="http://koajs.com/" target="_blank" rel="external">Koa web server</a>.</p>
</li>
<li><p>All <code>./css</code> files are extracted out, optimised and concatenated into a separate <code>dist/public/assets/css/style.css</code> file.  Styles are processed through the <a href="http://postcss.org/" target="_blank" rel="external">PostCSS</a> loader. On the server, hashed versions of any class names used are calculated and included in the server bundle, so invoking those classes later alongside React components will match up with the compiled <code>style.css</code> file.</p>
</li>
<li><p>Imported images are optimised/crunched through <a href="https://github.com/imagemin/imagemin" target="_blank" rel="external">imagemin</a>, and wind up in <code>dist/public/assets/img/</code>.</p>
</li>
<li><p>Imported fonts are copied to <code>dist/public/assets/fonts</code>.</p>
</li>
</ol>
<blockquote>
<p>Once assets have been built, you can run <code>npm run server</code> to start a live web server</p>
</blockquote>
<h2 id="gzip">Gzip compression</h2>

<hr>
<p>Gzip is a standard compression technology supported by all major browsers, that can significantly reduce file sizes and data downloads, and provide users with a faster first load.</p>
<p>Static assets that wind up in the <code>dist/</code> folder – including CSS, images and fonts – get gzip’d <code>.gz</code> versions automatically courtesy of the <a href="https://webpack.js.org/plugins/compression-webpack-plugin/" target="_blank" rel="external">Compression Webpack Plugin</a>. Alongside the original, a new <code>[file].gz</code> will appear in the same folder – e.g. <code>styles.css</code> gets a <code>styles.css.gz</code> too.</p>
<p>The ReactQL web server that comes built-in will look for <code>.gz</code> file before serving the original.  If it finds one, it’ll send that version down the wire instead.</p>
<p>Since your assets are minified one-time in advance, this prevents CPU cycles crunching the data in ‘real-time’ for every visit.</p>
<p>You don’t need to do anything to activate this– it’s enabled autoamtically.</p>

    </div>
  </div>

  <div class="pagination">
    <div class="content-wrapper">
      
      
        <a class="link primary prev"
          href="routing.html">
          <span class="icon-arrow-left-alt"></span>
          <span class="subtitle-pagination">Previous</span>
          Routing
        </a>
      
      
        <a class="link primary next"
          href="ssr.html">
          <span class="subtitle-pagination">Next</span>
          Server side rendering (SSR)
          <span class="icon-arrow-right-alt"></span>
        </a>
      
    </div>
  </div>

  <div class="github">
    <a class="link tertiary " href="https://github.com/leebenson/reactql-docs/tree/master/source/bundling.md" target="_blank">
      <span class="icon-github"></span>Edit on GitHub</a>
  </div>
</div>

    <script src="/docs/script/smooth-scroll.min.js"></script>
    <script src="/docs/script/main.js"></script>
    <script type="text/javascript" src="//cdn.jsdelivr.net/docsearch.js/1/docsearch.min.js"></script>
    <script type="text/javascript" src="//cdn.jsdelivr.net/fastclick/1.0.6/fastclick.min.js"></script>

    <script>
     
      

      // search box
      

      
    </script>
  </body>
</html>
